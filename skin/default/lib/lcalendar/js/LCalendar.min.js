window.LCalendar=(function(){var a=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxD=31};a.prototype={init:function(e){this.type=e.type;this.trigger=document.querySelector(e.trigger);if(this.trigger.getAttribute("data-lcalendar")!=null){var b=this.trigger.getAttribute("data-lcalendar").split(",");var d=b[0].split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2];var c=b[1].split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}if(e.minDate){var d=e.minDate.split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2]}if(e.maxDate){var c=e.maxDate.split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}this.bindEvent(this.type)},bindEvent:function(e){var f=this;function d(D){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>';document.body.appendChild(f.gearDate);p();var C=f.gearDate.querySelector(".lcalendar_cancel");C.addEventListener("touchstart",k);var B=f.gearDate.querySelector(".lcalendar_finish");B.addEventListener("touchstart",q);var z=f.gearDate.querySelector(".date_yy");var y=f.gearDate.querySelector(".date_mm");var A=f.gearDate.querySelector(".date_dd");z.addEventListener("touchstart",c);y.addEventListener("touchstart",c);A.addEventListener("touchstart",c);z.addEventListener("touchmove",v);y.addEventListener("touchmove",v);A.addEventListener("touchmove",v);z.addEventListener("touchend",i);y.addEventListener("touchend",i);A.addEventListener("touchend",i)}function p(){var y=new Date();var z={yy:y.getFullYear(),mm:y.getMonth(),dd:y.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-)\d{1,4}/g);z.yy=rs[0]-f.minY;z.mm=rs[1].replace(/-/g,"")-1;z.dd=rs[2].replace(/-/g,"")-1}else{z.yy=z.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",z.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",z.mm);f.gearDate.querySelector(".date_dd").setAttribute("val",z.dd);w()}function n(C){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div>';document.body.appendChild(f.gearDate);m();var B=f.gearDate.querySelector(".lcalendar_cancel");B.addEventListener("touchstart",k);var A=f.gearDate.querySelector(".lcalendar_finish");A.addEventListener("touchstart",r);var z=f.gearDate.querySelector(".date_yy");var y=f.gearDate.querySelector(".date_mm");z.addEventListener("touchstart",c);y.addEventListener("touchstart",c);z.addEventListener("touchmove",v);y.addEventListener("touchmove",v);z.addEventListener("touchend",i);y.addEventListener("touchend",i)}function m(){var y=new Date();var z={yy:y.getFullYear(),mm:y.getMonth()};if(/^\d{4}-\d{1,2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-)\d{1,4}/g);z.yy=rs[0]-f.minY;z.mm=rs[1].replace(/-/g,"")-1}else{z.yy=z.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",z.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",z.mm);w()}function j(F){f.gearDate=document.createElement("div");f.gearDate.className="gearDatetime";f.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>';document.body.appendChild(f.gearDate);u();var D=f.gearDate.querySelector(".lcalendar_cancel");D.addEventListener("touchstart",k);var C=f.gearDate.querySelector(".lcalendar_finish");C.addEventListener("touchstart",l);var z=f.gearDate.querySelector(".date_yy");var y=f.gearDate.querySelector(".date_mm");var B=f.gearDate.querySelector(".date_dd");var A=f.gearDate.querySelector(".time_hh");var E=f.gearDate.querySelector(".time_mm");z.addEventListener("touchstart",c);y.addEventListener("touchstart",c);B.addEventListener("touchstart",c);A.addEventListener("touchstart",c);E.addEventListener("touchstart",c);z.addEventListener("touchmove",v);y.addEventListener("touchmove",v);B.addEventListener("touchmove",v);A.addEventListener("touchmove",v);E.addEventListener("touchmove",v);z.addEventListener("touchend",i);y.addEventListener("touchend",i);B.addEventListener("touchend",i);A.addEventListener("touchend",i);E.addEventListener("touchend",i)}function u(){var y=new Date();var z={yy:y.getFullYear(),mm:y.getMonth(),dd:y.getDate()-1,hh:y.getHours(),mi:y.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|-|\s|:)\d{1,4}/g);z.yy=rs[0]-f.minY;z.mm=rs[1].replace(/-/g,"")-1;z.dd=rs[2].replace(/-/g,"")-1;z.hh=parseInt(rs[3].replace(/\s0?/g,""));z.mi=parseInt(rs[4].replace(/:0?/g,""))}else{z.yy=z.yy-f.minY}f.gearDate.querySelector(".date_yy").setAttribute("val",z.yy);f.gearDate.querySelector(".date_mm").setAttribute("val",z.mm);f.gearDate.querySelector(".date_dd").setAttribute("val",z.dd);w();f.gearDate.querySelector(".time_hh").setAttribute("val",z.hh);f.gearDate.querySelector(".time_mm").setAttribute("val",z.mi);h()}function s(C){f.gearDate=document.createElement("div");f.gearDate.className="gearDate";f.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>';document.body.appendChild(f.gearDate);g();var A=f.gearDate.querySelector(".lcalendar_cancel");A.addEventListener("touchstart",k);var z=f.gearDate.querySelector(".lcalendar_finish");z.addEventListener("touchstart",x);var y=f.gearDate.querySelector(".time_hh");var B=f.gearDate.querySelector(".time_mm");y.addEventListener("touchstart",c);B.addEventListener("touchstart",c);y.addEventListener("touchmove",v);B.addEventListener("touchmove",v);y.addEventListener("touchend",i);B.addEventListener("touchend",i)}function g(){var z=new Date();var y={hh:z.getHours(),mm:z.getMinutes()};if(/^\d{2}:\d{2}$/.test(f.trigger.value)){rs=f.trigger.value.match(/(^|:)\d{2}/g);y.hh=parseInt(rs[0].replace(/^0?/g,""));y.mm=parseInt(rs[1].replace(/:0?/g,""))}f.gearDate.querySelector(".time_hh").setAttribute("val",y.hh);f.gearDate.querySelector(".time_mm").setAttribute("val",y.mm);h()}function w(){var z=f.maxY-f.minY+1;var L=f.gearDate.querySelector(".date_yy");var N="";if(L&&L.getAttribute("val")){var C=parseInt(L.getAttribute("val"));for(var A=0;A<=z-1;A++){N+="<div class='tooth'>"+(f.minY+A)+"</div>"}L.innerHTML=N;var J=Math.floor(parseFloat(L.getAttribute("top")));if(!isNaN(J)){J%2==0?(J=J):(J=J+1);J>8&&(J=8);var F=8-(z-1)*2;J<F&&(J=F);L.style["-webkit-transform"]="translate3d(0,"+J+"em,0)";L.setAttribute("top",J+"em");C=Math.abs(J-8)/2;L.setAttribute("val",C)}else{L.style["-webkit-transform"]="translate3d(0,"+(8-C*2)+"em,0)";L.setAttribute("top",8-C*2+"em")}}else{return}var H=f.gearDate.querySelector(".date_mm");if(H&&H.getAttribute("val")){N="";var E=parseInt(H.getAttribute("val"));var I=11;var K=0;if(C==z-1){I=f.maxM-1}if(C==0){K=f.minM-1}for(var A=0;A<I-K+1;A++){N+="<div class='tooth'>"+(K+A+1)+"</div>"}H.innerHTML=N;if(E>I){E=I;H.setAttribute("val",E)}else{if(E<K){E=I;H.setAttribute("val",E)}}H.style["-webkit-transform"]="translate3d(0,"+(8-(E-K)*2)+"em,0)";H.setAttribute("top",8-(E-K)*2+"em")}else{return}var y=f.gearDate.querySelector(".date_dd");if(y&&y.getAttribute("val")){N="";var G=parseInt(y.getAttribute("val"));var D=o(C,E);var M=D-1;var B=0;if(C==z-1&&f.maxM==E+1){M=f.maxD-1}if(C==0&&f.minM==E+1){B=f.minD-1}for(var A=0;A<M-B+1;A++){N+="<div class='tooth'>"+(B+A+1)+"</div>"}y.innerHTML=N;if(G>M){G=M;y.setAttribute("val",G)}else{if(G<B){G=B;y.setAttribute("val",G)}}y.style["-webkit-transform"]="translate3d(0,"+(8-(G-B)*2)+"em,0)";y.setAttribute("top",8-(G-B)*2+"em")}else{return}}function h(){var z=f.gearDate.querySelector(".time_hh");if(z&&z.getAttribute("val")){var A="";var D=parseInt(z.getAttribute("val"));for(var B=0;B<=23;B++){A+="<div class='tooth'>"+B+"</div>"}z.innerHTML=A;z.style["-webkit-transform"]="translate3d(0,"+(8-D*2)+"em,0)";z.setAttribute("top",8-D*2+"em")}else{return}var C=f.gearDate.querySelector(".time_mm");if(C&&C.getAttribute("val")){var A="";var y=parseInt(C.getAttribute("val"));for(var B=0;B<=59;B++){A+="<div class='tooth'>"+B+"</div>"}C.innerHTML=A;C.style["-webkit-transform"]="translate3d(0,"+(8-y*2)+"em,0)";C.setAttribute("top",8-y*2+"em")}else{return}}function o(y,z){if(z==1){y+=f.minY;if((y%4==0&&y%100!=0)||(y%400==0&&y%4000!=0)){return 29}else{return 28}}else{if(z==3||z==5||z==8||z==10){return 30}else{return 31}}}function c(A){A.preventDefault();var z=A.target;while(true){if(!z.classList.contains("gear")){z=z.parentElement}else{break}}clearInterval(z["int_"+z.id]);z["old_"+z.id]=A.targetTouches[0].screenY;z["o_t_"+z.id]=(new Date()).getTime();var y=z.getAttribute("top");if(y){z["o_d_"+z.id]=parseFloat(y.replace(/em/g,""))}else{z["o_d_"+z.id]=0}z.style.webkitTransitionDuration=z.style.transitionDuration="0ms"}function v(A){A.preventDefault();var z=A.target;while(true){if(!z.classList.contains("gear")){z=z.parentElement}else{break}}z["new_"+z.id]=A.targetTouches[0].screenY;z["n_t_"+z.id]=(new Date()).getTime();var y=(z["new_"+z.id]-z["old_"+z.id])*30/window.innerHeight;z["pos_"+z.id]=z["o_d_"+z.id]+y;z.style["-webkit-transform"]="translate3d(0,"+z["pos_"+z.id]+"em,0)";z.setAttribute("top",z["pos_"+z.id]+"em");if(A.targetTouches[0].screenY<1){i(A)}}function i(A){A.preventDefault();var z=A.target;while(true){if(!z.classList.contains("gear")){z=z.parentElement}else{break}}var y=(z["new_"+z.id]-z["old_"+z.id])/(z["n_t_"+z.id]-z["o_t_"+z.id]);if(Math.abs(y)<=0.2){z["spd_"+z.id]=(y<0?-0.08:0.08)}else{if(Math.abs(y)<=0.5){z["spd_"+z.id]=(y<0?-0.16:0.16)}else{z["spd_"+z.id]=y/2}}if(!z["pos_"+z.id]){z["pos_"+z.id]=0}t(z)}function t(B){var C=0;var y=false;function A(){B.style.webkitTransitionDuration=B.style.transitionDuration="200ms";y=true}var z=f.maxY-f.minY+1;clearInterval(B["int_"+B.id]);B["int_"+B.id]=setInterval(function(){var L=B["pos_"+B.id];var G=B["spd_"+B.id]*Math.exp(-0.03*C);L+=G;if(Math.abs(G)>0.1){}else{var M=Math.round(L/2)*2;L=M;A()}if(L>8){L=8;A()}switch(B.dataset.datetype){case"date_yy":var I=8-(z-1)*2;if(L<I){L=I;A()}if(y){var O=Math.abs(L-8)/2;b(B,O);clearInterval(B["int_"+B.id])}break;case"date_mm":var P=f.gearDate.querySelector(".date_yy");var E=parseInt(P.getAttribute("val"));var K=11;var N=0;if(E==z-1){K=f.maxM-1}if(E==0){N=f.minM-1}var I=8-(K-N)*2;if(L<I){L=I;A()}if(y){var O=Math.abs(L-8)/2+N;b(B,O);clearInterval(B["int_"+B.id])}break;case"date_dd":var P=f.gearDate.querySelector(".date_yy");var J=f.gearDate.querySelector(".date_mm");var E=parseInt(P.getAttribute("val"));var H=parseInt(J.getAttribute("val"));var F=o(E,H);var Q=F-1;var D=0;if(E==z-1&&f.maxM==H+1){Q=f.maxD-1}if(E==0&&f.minM==H+1){D=f.minD-1}var I=8-(Q-D)*2;if(L<I){L=I;A()}if(y){var O=Math.abs(L-8)/2+D;b(B,O);clearInterval(B["int_"+B.id])}break;case"time_hh":if(L<-38){L=-38;A()}if(y){var O=Math.abs(L-8)/2;b(B,O);clearInterval(B["int_"+B.id])}break;case"time_mm":if(L<-110){L=-110;A()}if(y){var O=Math.abs(L-8)/2;b(B,O);clearInterval(B["int_"+B.id])}break;default:}B["pos_"+B.id]=L;B.style["-webkit-transform"]="translate3d(0,"+L+"em,0)";B.setAttribute("top",L+"em");C++},30)}function b(y,z){z=Math.round(z);y.setAttribute("val",z);if(/date/.test(y.dataset.datetype)){w()}else{h()}}function k(z){z.preventDefault();var y;try{y=new CustomEvent("input")}catch(z){y=document.createEvent("Event");y.initEvent("input",true,true)}f.trigger.dispatchEvent(y);document.body.removeChild(f.gearDate);f.gearDate=null}function q(C){var B=f.maxY-f.minY+1;var z=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var y=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;y=y>9?y:"0"+y;var A=parseInt(Math.round(f.gearDate.querySelector(".date_dd").getAttribute("val")))+1;A=A>9?A:"0"+A;f.trigger.value=(z%B+f.minY)+"-"+y+"-"+A;k(C)}function r(B){var A=f.maxY-f.minY+1;var z=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var y=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;y=y>9?y:"0"+y;f.trigger.value=(z%A+f.minY)+"-"+y;k(B)}function l(E){var C=f.maxY-f.minY+1;var z=parseInt(Math.round(f.gearDate.querySelector(".date_yy").getAttribute("val")));var y=parseInt(Math.round(f.gearDate.querySelector(".date_mm").getAttribute("val")))+1;y=y>9?y:"0"+y;var B=parseInt(Math.round(f.gearDate.querySelector(".date_dd").getAttribute("val")))+1;B=B>9?B:"0"+B;var A=parseInt(Math.round(f.gearDate.querySelector(".time_hh").getAttribute("val")));A=A>9?A:"0"+A;var D=parseInt(Math.round(f.gearDate.querySelector(".time_mm").getAttribute("val")));D=D>9?D:"0"+D;f.trigger.value=(z%C+f.minY)+"-"+y+"-"+B+" "+(A.length<2?"0":"")+A+(D.length<2?":0":":")+D;k(E)}function x(A){var y=parseInt(Math.round(f.gearDate.querySelector(".time_hh").getAttribute("val")));y=y>9?y:"0"+y;var z=parseInt(Math.round(f.gearDate.querySelector(".time_mm").getAttribute("val")));z=z>9?z:"0"+z;f.trigger.value=(y.length<2?"0":"")+y+(z.length<2?":0":":")+z;k(A)}f.trigger.addEventListener("click",{ym:n,date:d,datetime:j,time:s}[e])}};return a})();