/*!
 * body-parser
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
;"use strict";var bytes=require("bytes");var contentType=require("content-type");var debug=require("debug")("body-parser:text");var read=require("../read");var typeis=require("type-is");module.exports=text;function text(j){var a=j||{};var d=a.defaultCharset||"utf-8";var h=a.inflate!==false;var c=typeof a.limit!=="number"?bytes.parse(a.limit||"100kb"):a.limit;var e=a.type||"text/plain";var f=a.verify||false;if(f!==false&&typeof f!=="function"){throw new TypeError("option verify must be function")}var i=typeof e!=="function"?typeChecker(e):e;function b(k){return k}return function g(m,k,l){if(m._body){debug("body already parsed");l();return}m.body=m.body||{};if(!typeis.hasBody(m)){debug("skip empty body");l();return}debug("content-type %j",m.headers["content-type"]);if(!i(m)){debug("skip parsing");l();return}var n=getCharset(m)||d;read(m,k,l,b,debug,{encoding:n,inflate:h,limit:c,verify:f})}}function getCharset(a){try{return(contentType.parse(a).parameters.charset||"").toLowerCase()}catch(b){return undefined}}function typeChecker(b){return function a(c){return Boolean(typeis(c,b))}};